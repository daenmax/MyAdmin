## 说明

数据权限是根据用户绑定的角色进行划分，等级有

```
0=本人数据，1=本部门数据，2=本部门及以下数据，3=全部数据，4=自定义权限（指定部门）
```

## 如何使用

业务表中需要有`创建人用户ID`这个字段，本框架使用的字段名叫`create_id`。
只要有这个字段就可以实现数据权限

### 查询

在impl实现方法上增加注解`@DataScope`

```java
/**
 * 查询
 *
 * @param id
 * @return
 */
@DataScope(alias = "test_data")
@Override
public TestData getData(String id){
        return testDataMapper.selectById(id);
}
```

### 修改

在impl实现方法上增加注解`@DataScope`

```java
/**
 * 修改
 *
 * @param vo
 */
@DataScope(alias = "test_data")
@Override
public void editData(TestDataUpdVo vo){
        LambdaUpdateWrapper<TestData> updateWrapper=new LambdaUpdateWrapper<>();
        updateWrapper.eq(TestData::getId,vo.getId());
        updateWrapper.set(TestData::getTitle,vo.getTitle());
        updateWrapper.set(TestData::getContent,vo.getContent());
        updateWrapper.set(TestData::getRemark,vo.getRemark());
        int rows=testDataMapper.update(null,updateWrapper);
        if(rows< 1){
            throw new MyException("修改失败");
        }
}
```

### 删除

在impl实现方法上增加注解`@DataScope`

```java
/**
 * 删除
 *
 * @param ids
 */
@DataScope(alias = "test_data")
@Override
public void deleteByIds(String[]ids){
        List<String> idList=Arrays.asList(ids);
        int i=testDataMapper.deleteBatchIds(idList);
        if(i< 1){
            throw new MyException("删除失败");
        }
}
```

### 分页

alias表示表的别名，就是你自己写的SQL，里面业务表的别名

field表示`创建人用户ID`字段，默认是`create_id`

#### 1.使用MyBatisPlus分页插件

在impl实现方法上增加注解`@DataScope`

```java
/**
 * 测试数据分页列表_MP分页插件
 *
 * @param vo
 * @return
 */
@DataScope(alias = "test_data")
@Override
public IPage<TestData> getPage1(TestDataPageVo vo){
        LambdaQueryWrapper<TestData> wrapper=new LambdaQueryWrapper<>();
        wrapper.eq(ObjectUtil.isNotEmpty(vo.getTitle()),TestData::getTitle,vo.getTitle());
        wrapper.like(ObjectUtil.isNotEmpty(vo.getContent()),TestData::getContent,vo.getContent());
        wrapper.like(ObjectUtil.isNotEmpty(vo.getRemark()),TestData::getRemark,vo.getRemark());
        String startTime=vo.getStartTime();
        String endTime=vo.getEndTime();
        wrapper.between(ObjectUtil.isNotEmpty(startTime)&&ObjectUtil.isNotEmpty(endTime),TestData::getCreateTime,startTime,endTime);
        Page<TestData> testDataPage=testDataMapper.selectPage(vo.getPage(true),wrapper);
        return testDataPage;
}
```

#### 2.自己在XML里写SQL

例如分页接口，在mapper方法上，增加注解`@DataScope`，例如

```java
@DataScope(alias = "td")
IPage<TestDataPageDto> getPage(Page<TestDataPageDto> page,@Param("vo") TestDataPageVo vo);
```

#### 3.使用MyBatisPlus自定义SQL

例如分页接口，在mapper方法上，增加注解`@DataScope`，例如

```java
@DataScope(alias = "td")
IPage<TestDataPageDto> getPageWrapper(Page<TestDataPageDto> page,@Param("ew") Wrapper<TestData> wrapper);
```

然后impl里如下调用

```java
/**
 * 测试数据分页列表_MP自定义SQL
 *
 * @param vo
 * @return
 */
@Override
public IPage<TestDataPageDto> getPage3(TestDataPageVo vo){
        QueryWrapper<TestData> wrapper=new QueryWrapper<>();
        wrapper.eq(ObjectUtil.isNotEmpty(vo.getTitle()),"td.title",vo.getTitle());
        wrapper.like(ObjectUtil.isNotEmpty(vo.getContent()),"td.content",vo.getContent());
        wrapper.like(ObjectUtil.isNotEmpty(vo.getRemark()),"td.remark",vo.getRemark());
        String startTime=vo.getStartTime();
        String endTime=vo.getEndTime();
        wrapper.between(ObjectUtil.isNotEmpty(startTime)&&ObjectUtil.isNotEmpty(endTime),"td.create_time",startTime,endTime);
        IPage<TestDataPageDto> iPage=testDataMapper.getPageWrapper(vo.getPage(true),wrapper);
        return iPage;
}
```
